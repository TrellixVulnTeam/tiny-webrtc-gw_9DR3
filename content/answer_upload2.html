<html>
<head>
<script src="src/js/adapter.js"></script>
<script src="src/js/lib/ga.js"></script>
<script src="js/popup.js"></script>
<script src="js/peers.js"></script>
<script language='javascript'>

var popupRecvOnly = false;

function nameChanged() {
    var l = 'https://' + window.location.hostname + ':' + window.location.port + '/content/index_broadcast.html?args=' + document.theform.my_name.value;
    document.theform.my_link.value = l;
}

function onLoad() {
    nameChanged();
    showDebug();
}

function showDebug(show) {
    if (show) {
        document.getElementById('debugDiv').style = '';
    }
    else {
        document.getElementById('debugDiv').style = 'display: none;';
    }
}

function getForm() {
    return document.theform;
}

function connect(sender) {
    getForm().appendsdp.value += 'a=myname='+getForm().my_name.value + '\n';
    sender.hidden = true;
    onConnect();
    document.getElementById('msgDiv').hidden=false;
}

</script>
</head>

<body onLoad='onLoad()'>

<div id='debugDiv'>

<table>
<tr>
  <td colspan=2>
    SDP Answer:
  </td>
</tr>
<tr><td colspan=2>
<form method=POST name="finalform" action="/sdp_answer.txt">
<textarea name="answersdp" hidden=true></textarea>
</form>
</td></tr><tr><td colspan=2>
<form method=POST name="theform" action="/sdp_answer.txt">
<textarea name="answersdp" rows=10 cols=40></textarea>
</td></tr><tr><td colspan=2>
<textarea name="appendsdp" rows=2 cols=40></textarea>
</td></tr><tr><td colspan=2>
<textarea name="offersdp" rows=2 cols=40></textarea>
</td></tr>
</table>
</div>
<table>
<div id="myUsernameDiv">
<tr>
    <td>
        My username:
    </td>
    <td>
        <input type="text" id="my_name" name="my_name" value="user1" onKeyup="nameChanged()"></input>
    </td>
</tr>
<tr>
    <td>
        My broadcast link (share before starting):
    </td>
    <td>
        <input type="text" id="my_link" name="my_link" value=""></input>
    </td>
</tr>
</table>
</div>
<br>
<table>
<tr><td>receive only:</td><td><input type='checkbox' disabled name='recvonly' id='recvonly' value=true></input></td></tr>
<tr><td>send only (no mirror):</td><td><input type='checkbox' name='sendonly' id='sendonly' onclick="getForm().offersdp.value=getForm().offersdp.value.replace(/sendrecv/g, 'recvonly');" value=false></input></td></tr>
<tr><td>show sdp debug:</td><td><input type='checkbox' name='debugEnable' id='debugEnable' onclick="showDebug(this.checked);"></input></td></tr>
</table>

<input type="hidden" id="peerstream_recv" name="peerstream_recv" value="%$URLARGUMENTS$%"></input>

<div id="watchableUsersDiv" style="height:100px; overflow:auto; background-color:grey;">
<p>User streams:
<br>
<!--
<br>
%$PEERLISTHTML$%
-->
</div>
<script language='javascript'>
    var d = document.getElementById('watchableUsersDiv');
    var i;
    for(i = 0; i < peerList.length && '%$URLARGUMENTS$%'.length == 0; i++) {
        var attrs = '';
        var watchDesc = '';
        if(peerList[i].recvonly) {
            attrs += ' disabled';
            watchDesc = '(just watching)';
        }
        d.innerHTML += '<input type="checkbox" onClick="onPeerClick(\''+peerList[i].name+'\', this);" '+attrs+'>'+peerList[i].name+' '+watchDesc+'</input><br>';
    }

    if(peerList.length == 0) {
        d.innerHTML += '<p>nobody here<br>'
    }

    if('%$URLARGUMENTS$%'.length > 0)
    {
        document.theform.peerstream_recv.hidden = false;
        document.theform.peerstream_recv.value = '%$URLARGUMENTS$%';
        document.theform.appendsdp.value += 'a=watch=' + '%$URLARGUMENTS$%\n';
        d.innerHTML += '<p>click OK to start watching %$URLARGUMENTS$%<br>'
    }
</script>
<br>

<br>
</form>
<button name='button_connect' id='button_connect' onclick="connect(self);">Ok</button>
<div id='msgDiv' hidden=true>
<p>Connecting...wait...
<!--
<button name='button_close' id='button_close' onclick='doSubmit()'>close</button>
-->
</div>
</body>
<script language='javascript'>
document.getElementById("recvonly").checked = opener.popupRecvOnly;
document.getElementById('watchableUsersDiv').hidden = !opener.popupRecvOnly;
document.getElementById('myUsernameDiv').hidden = opener.popupRecvOnly;
</script>
<iframe name='iframe_submit' width=200 height=100>
</iframe>
</html>

