<html>
<head>
<script language='javascript'>

var shouldClose = true;

function onLoad() {
    parent.iframeOnLoad();
    
    doPeerDynamicOnLoad();

    closeInXSeconds(5);
}

function done() {
    parent.close();
}

function closeInXSeconds(sec) {
    parent.setTimeout(function() { if(shouldClose) done();}, sec * 1000);
}
</script>
    </head>
    <body onLoad='onLoad();'>
        <p>upload complete!
        <br>
        <p>closing in a few seconds...
        <br>
        <button onClick='done();'>close</button>
        <br>
        <button onClick='shouldClose = false;'>wait</button>
        <br>
        <p>some browsers (Android/chrome) require switching back to parent window/tab to close
    </body>
    <script language='javascript'>
        if(navigator.userAgent.indexOf('android') >= 0 ||
           navigator.userAgent.indexOf('Android') >= 0) {
           /* TODO: find a way to restore focus on Android that works?
            * (hack around a problem with pop closing/connecting video
            *  stream)
            */
        }
        else {
            window.close();
        }
    </script>
<script language='javascript' src='js/peerdynamic.js'></script>
</html>
